~"begin"v(~"bind"h(@text-color &" nex color"v(~"set-nex-style"h($"color" @color @nex~)&)~) ~"bind"h(@font &" nex fontname"v(~"set-nex-style"h($"font-family" @fontname @nex~)&)~) ~"bind"h(@text-size &" nex size"v(~"set-nex-style"h($"font-size" ~"string-cat"h(@size $"px"~) @nex~)&)~) ~"bind"h(@background-color &" nex color"v(~"set-nex-style"h($"background-color" @color @nex~)&)~) ~"bind"h(@height &" nex height"v(~"set-nex-style"h($"height" ~"string-cat"h(@height $"px"~) @nex~)&)~) ~"bind"h(@width &" nex width"v(~"set-nex-style"h($"width" ~"string-cat"h(@width $"px"~) @nex~)&)~) ~"bind"h(@italic &" nex"v(~"set-nex-style"h($"font-style" $"italic" @nex~)&)~) ~"bind"h(@bold &" nex"v(~"set-nex-style"h($"font-weight" $"bold" @nex~)&)~) ~"bind"h(@set-nex-style &" stylename styleval nex"v(~"bind"h(@style-list ~"parse-style"h(~"get-style-from"h(@nex~)~)~) ~"bind"h(@new-style-list ~"set-style"h(@stylename @styleval @style-list~)~) ~"apply-style-to"h(~"join-style"h(@new-style-list~) @nex~)&)~) ~"bind"h(@set-style &" stylename styleval stylelist"v(~"if"v(~"has-style"h(@stylename @stylelist~) ~"add-style"h(@stylename @styleval ~"remove-style"h(@stylename @stylelist~)~) ~"add-style"h(@stylename @styleval @stylelist~)~)&)~) ~"bind"h(@parse-style &" stylestring"v(~"bind"h(@stylelist ~"string-split"h(@stylestring $";"~)~) ~"bind"h(@split-pairs &" lst"v(~"if"v(~"is-empty"h(@lst~) () ~"begin"v(~"bind"h(@pair ~"string-split"h(~"car"h(@lst~) $":"~)~) ~"cons"v(@pair ~"split-pairs"h(~"cdr"h(@lst~)~)~)~)~)&)~) ~"split-pairs"h(@stylelist~)&)~) ~"bind"h(@join-style &" stylelist"v(~"if"v(~"is-empty"h(@stylelist~) $"" ~"begin"v(~"bind"h(@pair ~"car"h(@stylelist~)~) ~"bind"h(@pairstring ~"string-cat"v(~"car"h(@pair~) $":" ~"car"h(~"cdr"h(@pair~)~)~)~) ~"bind"h(@remaining ~"join-style"v(~"cdr"h(@stylelist~)~)~) ~"string-cat"v(@pairstring ~"if"v(~"string-eq"h(@remaining $""~) $"" $";"~) @remaining~)~)~)&)~) ~"bind"h(@add-style &" stylename styleval stylelist"v(~"cons"h(~"cons"h(@stylename ~"cons"h(@styleval ()~)~) @stylelist~)&)~) ~"bind"h(@remove-style &" stylename stylelist"v(~"if"v(~"is-empty"h(@stylelist~) () ~"begin"v(~"bind"h(@pair ~"car"h(@stylelist~)~) ~"bind"h(@name ~"car"h(@pair~)~) ~"if"v(~"string-eq"h(@name @stylename~) ~"cdr"h(@stylelist~) ~"cons"h(@pair ~"remove-style"h(@stylename @stylelist~)~)~)~)~)&)~) ~"bind"h(@has-style &" stylename stylelist"v(~"if"v(~"is-empty"h(@stylelist~) !no ~"begin"v(~"bind"h(@name ~"car"h(~"car"h(@stylelist~)~)~) ~"if"v(~"string-eq"h(@stylename @name~) !yes ~"has-style"h(@stylename ~"cdr"h(@stylelist~)~)~)~)~)&)~) ~"bind"h(@string-substr &" str start len pos"v(~"if"v(~"="h(@pos ~"+"h(@start @len~)~) $"" ~"if"v(~">="h(@pos @start~) ~"string-cat"v(~"string-char-at"h(@str @pos~) ~"string-substr"h(@str @start @len ~"+"h(@pos #1~)~)~) ~"string-substr"h(@str @start @len ~"+"h(@pos #1~)~)~)~)&)~) ~"bind"h(@string-split &" str on"v(~"bind"h(@first-index-of ~"string-index-of"h(@str @on~)~) ~"if"v(~"is-error"h(@first-index-of~) ~"if"h(~"string-eq"h(@str $""~) () ~"cons"h(@str ()~)~) ~"cons"v(~"string-substr"v(@str #0 @first-index-of #0~) ~"string-split"v(~"string-substr"v(@str ~"+"h(@first-index-of #1~) ~"-"h(~"string-length"h(@str~) ~"+"h(@first-index-of #1~)~) #0~) @on~)~)~)&)~)~)