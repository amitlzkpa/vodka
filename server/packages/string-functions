~"begin"v(~"bind"h(@italic &" nex"v(~"begin"v(~"bind"h(@stylestring ~"get-style-from"h(@nex~)~) ~"bind"h(@newstylestring ~"add-style"h($"font-style" $"italic" @stylestring~)~) ~"apply-style-to"h(@newstylestring @nex~)~)&)~) ~"bind"h(@add-style &" stylename styleval str"v(~"begin"v(~"bind"h(@stylelist ~"string-split"h(@str $";"~)~) ~"if"v(~"has-style"h(@stylename @styleval @stylelist~) @str ~"string-cat"h(@stylename $":" @styleval ~"if"h(~"string-eq"h(@str $""~) $"" $";"~) @str~)~)~)&)~) ~"bind"h(@has-style &" stylename styleval stylelist"v(~"if"v(~"is-empty"h(@stylelist~) !no ~"begin"v(~"bind"h(@style ~"car"h(@stylelist~)~) ~"bind"h(@pair ~"string-split"h(@style $":"~)~) ~"bind"h(@name ~"car"h(@pair~)~) ~"bind"h(@val ~"car"h(~"cdr"h(@pair~)~)~) ~"if"v(~"and"v(~"eq"h(@stylename @name~) ~"eq"h(@styleval @val~)~) !yes ~"has-style"h(~"cdr"h(@stylelist~)~)~)~)~)&)~) ~"bind"h(@string-substr &" str start len pos"v(~"if"v(~"="h(@pos ~"+"h(@start @len~)~) $"" ~"if"v(~">="h(@pos @start~) ~"string-cat"v(~"string-char-at"h(@str @pos~) ~"string-substr"h(@str @start @len ~"+"h(@pos #1~)~)~) ~"string-substr"h(@str @start @len ~"+"h(@pos #1~)~)~)~)&)~) ~"bind"h(@string-split &" str on"v(~"begin"v(~"bind"h(@first-index-of ~"string-index-of"h(@str @on~)~) ~"if"v(~"is-error"h(@first-index-of~) ~"if"h(~"string-eq"h(@str $""~) () ~"cons"h(@str ()~)~) ~"cons"v(~"string-substr"v(@str #0 @first-index-of #0~) ~"string-split"v(~"string-substr"v(@str ~"+"h(@first-index-of #1~) ~"-"h(~"string-length"h(@str~) ~"+"h(@first-index-of #1~)~) #0~) @on~)~)~)~)&)~)~)