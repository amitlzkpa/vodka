~"package"v( @layout ~"import"h( @util-functions~) ~"import"h( @style-functions~) ~"bind"h( @justify-doc-to-width-with-format-of &" doc sizelimit format"v( ~"use"h( @util~) ~"use"h( @style~) ~"let"h( @findbestsizeforline &" line"v( ~"let"h( @bestsize #8~) ~"let"h( @findbestsizeinrange &" range"v( ~"let"h( @thissize ~"car"h( @range~)~) ~"let"v( @pixelwidth ~"get-pixel-width"h( ~"with-text-in-size"h( ~"format"h( @line~) @thissize~)~)~) ~"if"v( ~"<"h( @pixelwidth @sizelimit~) ~"begin"v( ~"set"h( @bestsize @thissize~) ~"findbestsizeinrange"h( ~"cdr"h( @range~)~)~) @bestsize~)&)~) ~"findbestsizeinrange"h( ~"range-from-to"h( #9 #600~)~)&)~) ~"do-for-each-and-put-in"v( &" line"v( ~"jslog"h( @line~) ~"jslog"h( $"best size follows"~) ~"jslog"h( ~"findbestsizeforline"h( @line~)~) ~"with-text-in-size"h( ~"format"h( @line~) ~"findbestsizeforline"h( @line~)~)&) @doc {}~)&)~) ~"bind"h( @doc-with-contents-of &" lst"v( ~"put-contents-in"h( @lst {}~)&)~) ~"bind"h( @with-only-words &" lst"v( ~"with-only-items-satisfying"h( @lst @is-word~)&)~) ~"bind"h( @combine-lines &" doc"v( ~"use"h( @util~) ~"if"v( ~"is-empty"h( @doc~) [] ~"list-cat"h( ~"car"h( @doc~) ~"combine-lines"h( ~"cdr"h( @doc~)~)~)~)&)~) ~"bind"h( @flatten-lines &" doc"v( ~"use"h( @util~) ~"do-for-each"h( &" line"v( ~"flatten"h( @line~)&) @doc~)&)~)~)